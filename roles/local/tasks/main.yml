---
- include: linux.yml
  when: ansible_os_family == "RedHat" or ansible_os_family == "Debian"

- include: mac.yml
  when: ansible_os_family == "Darwin"

- name: Install programs
  package: name={{ item }}
  with_items:
    - bash-completion
    - lastpass-cli
    - "{{ 'python2-flake8' if ansible_os_family == 'RedHat' else 'flake8' }}"
  become: "{{ package_become }}"

- name: Install Atom packages
  apm:
    name: "{{ item }}"
  with_items:
    - language-ocaml
    - language-r
    - language-rust
    - language-vala-modern
    - linter
    - linter-flake8
    - linter-lintr
    - linter-rust
    - ocaml-indent
    - ocaml-merlin
    - rustfmt

- name: Setup 'opam update' cron job
  cron:
    name: Update opam package list
    job: opam update
    special_time: daily

- name: Git configuration
  git_config:
    name: "{{ item.name }}"
    value: "{{ item.value }}"
    scope: global
  with_items:
    - name: user.name
      value: Brendan Long
    - name: user.email
      value: self@brendanlong.com

- name: Setup bashrc
  blockinfile:
    path: ~/.bashrc
    block: "{{ lookup('file', 'files/bashrc') }}"
    create: yes
    marker: "#{mark} Ansible local block"
